#!/bin/bash
args=(
  -o StrictHostKeyChecking=no
  -o "ProxyCommand nc -U ${STATEDIR:-/run/rm}/ssh"
)
if [[ "$RM_EXEC_ENABLED_PASSWORD" != "1" ]];then
  args+=(-o PasswordAuthentication=no)
fi
args+=(root@localhost)
if [ "$#" -ne 0 ]; then
  args+=(
    /bin/sh
    -lc
    "'$*'"
  )
fi
exec ssh ${args[@]}
