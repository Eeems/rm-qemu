#!/bin/bash
set -e
if [ $# -gt 1 ] || [[ "$1" == "--help" ]] || [[ "$1" == "-h" ]]; then
  echo "Usage: rm-busybox [<disk>] <<EOF" >/dev/stderr
  echo "  ln-s /dev/null /etc/systemd/system/xochitl.service" >/dev/stderr
  echo "EOF" >/dev/stderr
  echo "  mmcblk2p2 is mounted to /mnt/rootA" >/dev/stderr
  echo "  mmcblk2p3 is mounted to /mnt/rootB" >/dev/stderr
  echo "  mmcblk2p4 is mounted to /mnt/home" >/dev/stderr
  exit 1
fi
if rm-is-running; then
  echo "Error: rm is running" >/dev/stderr
  exit 1
fi
rm-busybox-start "${1:-$(rm-image-path)}"
rm-busybox-mount
rm-busybox-exec </dev/stdin >/dev/stdout 2>/dev/stderr
rm-busybox-stop
