#!/bin/sh
set -e
if [ $# -ne 0 ]; then
  echo "Usage: rm-busybox [<disk>] <<EOF" >/dev/stderr
  echo "  ln-s /dev/null /etc/systemd/system/xochitl.service" >/dev/stderr
  echo "EOF" >/dev/stderr
  echo "  mmcblk2p2 is mounted to /mnt/rootA" >/dev/stderr
  echo "  mmcblk2p3 is mounted to /mnt/rootB" >/dev/stderr
  echo "  mmcblk2p4 is mounted to /mnt/home" >/dev/stderr
  exit 1
fi
if rm-is-running; then
  echo "Error: rm is running" >/dev/stderr
  exit 1
fi
rm-busybox-start "$1"
rm-busybox-exec <<EOF
  cd /mnt
  mkdir -p rootA rootB home
  mount /dev/mmcblk2p2 rootA
  mount /dev/mmcblk2p3 rootB
  mount /dev/mmcblk2p4 home
EOF
cat | rm-busybox-exec
rm-busybox-stop
