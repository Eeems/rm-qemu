#!/bin/bash
args=(
  -o StrictHostKeyChecking=no
  -o UserKnownHostsFile=/dev/null
  -o LogLevel=ERROR
  -p "${RM_BUSYBOX_PORT:-2221}"
)
ssh_version=$(ssh -V 2>&1 | cut -d' ' -f1 | cut -d_ -f2 | grep -o '[0-9\.]\+' | head -n1)
if version-test "$ssh_version" -ge 10.1; then
  args+=(-o WarnWeakCrypto=no)
fi
if [ -t 0 ]; then
  args+=(-t)
else
  args+=(-T)
fi
args+=(root@localhost)
if [ "$#" -ne 0 ]; then
  args+=(
    /bin/sh
    -lc
    "'$*'"
  )
fi
exec ssh "${args[@]}" </dev/stdin >/dev/stdout 2>/dev/stderr
