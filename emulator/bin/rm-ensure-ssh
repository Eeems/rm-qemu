#!/bin/sh
set -e
if ! [ -f ~/.ssh/id_rsa ]; then
  ssh-keygen -q \
    -f "$HOME/.ssh/id_rsa" \
    -N ''
fi
rm-busybox-start
rm-wait-busybox
rm-busybox-exec <<EOF
  mkdir -p \
    home/root/.ssh \
    rootA/home/root/.ssh \
    rootB/home/root/.ssh
  chmod 0700 \
    home/root/.ssh \
    rootA/home/root/.ssh \
    rootB/home/root/.ssh
EOF
rm-busybox-upload "$HOME/.ssh/id_rsa.pub" home/root/.ssh/authorized_keys
rm-busybox-exec <<EOF
  chmod 0600 home/root/.ssh/authorized_keys
  cp -a home/root/.ssh/authorized_keys rootA/home/root/.ssh/authorized_keys
  cp -a home/root/.ssh/authorized_keys rootB/home/root/.ssh/authorized_keys
EOF
rm-busybox-stop
