KERNEL_TAG ?= RM1XX_5.4.70_v1.6.2
KERNEL ?= 5.4.70
LOCALVERSION ?= v1.6.2-rm11x
TAG := ghcr.io/eeems/rm-qemu-artifact:kernel-${KERNEL_TAG}
OUTPUTS := zImage qemu.dtb

BUILD_ARGS := "KERNEL=$(KERNEL)"
BUILD_ARGS += "KERNEL_TAG=$(KERNEL_TAG)"
BUILD_ARGS += "LOCALVERSION=$(LOCALVERSION)"


CONFIGS := "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.6.2 LOCALVERSION=v1.6.2-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.3.4 LOCALVERSION=v1.3.4-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.3.3 LOCALVERSION=v1.3.3-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.2.6 LOCALVERSION=v1.2.6-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.2.5 LOCALVERSION=v1.2.5-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.2.4 LOCALVERSION=v1.2.4-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.2.3 LOCALVERSION=v1.2.3-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.2.2 LOCALVERSION=v1.2.2-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.2.1 LOCALVERSION=v1.2.1-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.2.0 LOCALVERSION=v1.2.0-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.1.0 LOCALVERSION=v1.1.0-rm11x"
CONFIGS += "KERNEL=5.4.70 KERNEL_TAG=RM1XX_5.4.70_v1.0.0 LOCALVERSION=v1.0.0-rm11x"

include ../target.mk

run: zImage qemu.dtb
	qemu-system-arm \
	  -machine \
	  mcimx7d-sabre \
	  -cpu \
	  cortex-a9 \
	  -smp \
	  2 \
	  -m \
	  2048 \
	  -kernel \
	  ./artifact/zImage \
	  -dtb \
	  ./artifact/qemu.dtb \
	  -serial \
	  mon:stdio \
	  -nographic
